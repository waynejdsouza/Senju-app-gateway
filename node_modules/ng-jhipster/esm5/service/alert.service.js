/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 Copyright 2013-2019 the original author or authors from the JHipster project.

 This file is part of the JHipster project, see https://www.jhipster.tech/
 for more information.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 */
import { Injectable, Sanitizer, SecurityContext } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { JhiConfigService } from '../config.service';
import * as i0 from "@angular/core";
import * as i1 from "../config.service";
import * as i2 from "@ngx-translate/core";
/**
 * @record
 */
export function JhiAlert() { }
if (false) {
    /** @type {?|undefined} */
    JhiAlert.prototype.id;
    /** @type {?} */
    JhiAlert.prototype.type;
    /** @type {?} */
    JhiAlert.prototype.msg;
    /** @type {?|undefined} */
    JhiAlert.prototype.params;
    /** @type {?|undefined} */
    JhiAlert.prototype.timeout;
    /** @type {?|undefined} */
    JhiAlert.prototype.toast;
    /** @type {?|undefined} */
    JhiAlert.prototype.position;
    /** @type {?|undefined} */
    JhiAlert.prototype.scoped;
    /** @type {?|undefined} */
    JhiAlert.prototype.close;
}
var JhiAlertService = /** @class */ (function () {
    function JhiAlertService(sanitizer, configService, translateService) {
        this.sanitizer = sanitizer;
        this.configService = configService;
        this.translateService = translateService;
        /** @type {?} */
        var config = this.configService.getConfig();
        this.toast = config.alertAsToast;
        this.i18nEnabled = config.i18nEnabled;
        this.alertId = 0; // unique id for each alert. Starts from 0.
        this.alerts = [];
        this.timeout = config.alertTimeout;
    }
    /**
     * @return {?}
     */
    JhiAlertService.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.alerts.splice(0, this.alerts.length);
    };
    /**
     * @return {?}
     */
    JhiAlertService.prototype.get = /**
     * @return {?}
     */
    function () {
        return this.alerts;
    };
    /**
     * @param {?} msg
     * @param {?=} params
     * @param {?=} position
     * @return {?}
     */
    JhiAlertService.prototype.success = /**
     * @param {?} msg
     * @param {?=} params
     * @param {?=} position
     * @return {?}
     */
    function (msg, params, position) {
        return this.addAlert({
            type: 'success',
            msg: msg,
            params: params,
            timeout: this.timeout,
            toast: this.isToast(),
            position: position
        }, []);
    };
    /**
     * @param {?} msg
     * @param {?=} params
     * @param {?=} position
     * @return {?}
     */
    JhiAlertService.prototype.error = /**
     * @param {?} msg
     * @param {?=} params
     * @param {?=} position
     * @return {?}
     */
    function (msg, params, position) {
        return this.addAlert({
            type: 'danger',
            msg: msg,
            params: params,
            timeout: this.timeout,
            toast: this.isToast(),
            position: position
        }, []);
    };
    /**
     * @param {?} msg
     * @param {?=} params
     * @param {?=} position
     * @return {?}
     */
    JhiAlertService.prototype.warning = /**
     * @param {?} msg
     * @param {?=} params
     * @param {?=} position
     * @return {?}
     */
    function (msg, params, position) {
        return this.addAlert({
            type: 'warning',
            msg: msg,
            params: params,
            timeout: this.timeout,
            toast: this.isToast(),
            position: position
        }, []);
    };
    /**
     * @param {?} msg
     * @param {?=} params
     * @param {?=} position
     * @return {?}
     */
    JhiAlertService.prototype.info = /**
     * @param {?} msg
     * @param {?=} params
     * @param {?=} position
     * @return {?}
     */
    function (msg, params, position) {
        return this.addAlert({
            type: 'info',
            msg: msg,
            params: params,
            timeout: this.timeout,
            toast: this.isToast(),
            position: position
        }, []);
    };
    /**
     * @private
     * @param {?} alertOptions
     * @return {?}
     */
    JhiAlertService.prototype.factory = /**
     * @private
     * @param {?} alertOptions
     * @return {?}
     */
    function (alertOptions) {
        var _this = this;
        /** @type {?} */
        var alert = {
            type: alertOptions.type,
            msg: this.sanitizer.sanitize(SecurityContext.HTML, alertOptions.msg),
            id: alertOptions.id,
            timeout: alertOptions.timeout,
            toast: alertOptions.toast,
            position: alertOptions.position ? alertOptions.position : 'top right',
            scoped: alertOptions.scoped,
            close: function (alerts) {
                return _this.closeAlert(alertOptions.id, alerts);
            }
        };
        if (!alert.scoped) {
            this.alerts.push(alert);
        }
        return alert;
    };
    /**
     * @param {?} alertOptions
     * @param {?} extAlerts
     * @return {?}
     */
    JhiAlertService.prototype.addAlert = /**
     * @param {?} alertOptions
     * @param {?} extAlerts
     * @return {?}
     */
    function (alertOptions, extAlerts) {
        var _this = this;
        alertOptions.id = this.alertId++;
        if (this.i18nEnabled && alertOptions.msg) {
            alertOptions.msg = this.translateService.instant(alertOptions.msg, alertOptions.params);
        }
        /** @type {?} */
        var alert = this.factory(alertOptions);
        if (alertOptions.timeout && alertOptions.timeout > 0) {
            setTimeout(function () {
                _this.closeAlert(alertOptions.id, extAlerts);
            }, alertOptions.timeout);
        }
        return alert;
    };
    /**
     * @param {?} id
     * @param {?=} extAlerts
     * @return {?}
     */
    JhiAlertService.prototype.closeAlert = /**
     * @param {?} id
     * @param {?=} extAlerts
     * @return {?}
     */
    function (id, extAlerts) {
        /** @type {?} */
        var thisAlerts = (extAlerts && extAlerts.length > 0) ? extAlerts : this.alerts;
        return this.closeAlertByIndex(thisAlerts.map(function (e) { return e.id; }).indexOf(id), thisAlerts);
    };
    /**
     * @param {?} index
     * @param {?} thisAlerts
     * @return {?}
     */
    JhiAlertService.prototype.closeAlertByIndex = /**
     * @param {?} index
     * @param {?} thisAlerts
     * @return {?}
     */
    function (index, thisAlerts) {
        return thisAlerts.splice(index, 1);
    };
    /**
     * @return {?}
     */
    JhiAlertService.prototype.isToast = /**
     * @return {?}
     */
    function () {
        return this.toast;
    };
    JhiAlertService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    JhiAlertService.ctorParameters = function () { return [
        { type: Sanitizer },
        { type: JhiConfigService },
        { type: TranslateService }
    ]; };
    /** @nocollapse */ JhiAlertService.ngInjectableDef = i0.defineInjectable({ factory: function JhiAlertService_Factory() { return new JhiAlertService(i0.inject(i0.Sanitizer), i0.inject(i1.JhiConfigService), i0.inject(i2.TranslateService)); }, token: JhiAlertService, providedIn: "root" });
    return JhiAlertService;
}());
export { JhiAlertService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    JhiAlertService.prototype.alertId;
    /**
     * @type {?}
     * @private
     */
    JhiAlertService.prototype.alerts;
    /**
     * @type {?}
     * @private
     */
    JhiAlertService.prototype.timeout;
    /**
     * @type {?}
     * @private
     */
    JhiAlertService.prototype.toast;
    /**
     * @type {?}
     * @private
     */
    JhiAlertService.prototype.i18nEnabled;
    /**
     * @type {?}
     * @private
     */
    JhiAlertService.prototype.sanitizer;
    /**
     * @type {?}
     * @private
     */
    JhiAlertService.prototype.configService;
    /**
     * @type {?}
     * @private
     */
    JhiAlertService.prototype.translateService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxlcnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLWpoaXBzdGVyLyIsInNvdXJjZXMiOlsic2VydmljZS9hbGVydC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQkEsT0FBTyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXZELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7Ozs7O0FBSXJELDhCQVVDOzs7SUFURyxzQkFBWTs7SUFDWix3QkFBbUI7O0lBQ25CLHVCQUFZOztJQUNaLDBCQUFhOztJQUNiLDJCQUFpQjs7SUFDakIseUJBQWdCOztJQUNoQiw0QkFBa0I7O0lBQ2xCLDBCQUFpQjs7SUFDakIseUJBQXFDOztBQUd6QztJQVdJLHlCQUNZLFNBQW9CLEVBQ3BCLGFBQStCLEVBQy9CLGdCQUFrQztRQUZsQyxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ3BCLGtCQUFhLEdBQWIsYUFBYSxDQUFrQjtRQUMvQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCOztZQUVwQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUU7UUFDN0MsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxXQUFXLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztRQUN0QyxJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLDJDQUEyQztRQUM3RCxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUM7SUFDdkMsQ0FBQzs7OztJQUVELCtCQUFLOzs7SUFBTDtRQUNHLElBQUksQ0FBQyxNQUFN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LE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDdkMsQ0FBQzs7OztJQUVELGlDQUFPOzs7SUFBUDtRQUNJLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN0QixDQUFDOztnQkF4SEosVUFBVSxTQUFDO29CQUNSLFVBQVUsRUFBRSxNQUFNO2lCQUNyQjs7OztnQkFyQm9CLFNBQVM7Z0JBR3JCLGdCQUFnQjtnQkFGaEIsZ0JBQWdCOzs7MEJBbkJ6QjtDQThKQyxBQXpIRCxJQXlIQztTQXRIWSxlQUFlOzs7Ozs7SUFFeEIsa0NBQXdCOzs7OztJQUN4QixpQ0FBMkI7Ozs7O0lBQzNCLGtDQUF3Qjs7Ozs7SUFDeEIsZ0NBQXVCOzs7OztJQUN2QixzQ0FBNkI7Ozs7O0lBR3pCLG9DQUE0Qjs7Ozs7SUFDNUIsd0NBQXVDOzs7OztJQUN2QywyQ0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuIENvcHlyaWdodCAyMDEzLTIwMTkgdGhlIG9yaWdpbmFsIGF1dGhvciBvciBhdXRob3JzIGZyb20gdGhlIEpIaXBzdGVyIHByb2plY3QuXG5cbiBUaGlzIGZpbGUgaXMgcGFydCBvZiB0aGUgSkhpcHN0ZXIgcHJvamVjdCwgc2VlIGh0dHBzOi8vd3d3LmpoaXBzdGVyLnRlY2gvXG4gZm9yIG1vcmUgaW5mb3JtYXRpb24uXG5cbiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG4gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IEluamVjdGFibGUsIFNhbml0aXplciwgU2VjdXJpdHlDb250ZXh0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5cbmltcG9ydCB7IEpoaUNvbmZpZ1NlcnZpY2UgfSBmcm9tICcuLi9jb25maWcuc2VydmljZSc7XG5cbmV4cG9ydCB0eXBlIEpoaUFsZXJ0VHlwZSA9ICAnc3VjY2VzcycgfCAnZGFuZ2VyJyB8ICd3YXJuaW5nJyB8ICdpbmZvJztcblxuZXhwb3J0IGludGVyZmFjZSBKaGlBbGVydCB7XG4gICAgaWQ/OiBudW1iZXI7XG4gICAgdHlwZTogSmhpQWxlcnRUeXBlO1xuICAgIG1zZzogc3RyaW5nO1xuICAgIHBhcmFtcz86IGFueTtcbiAgICB0aW1lb3V0PzogbnVtYmVyO1xuICAgIHRvYXN0PzogYm9vbGVhbjtcbiAgICBwb3NpdGlvbj86IHN0cmluZztcbiAgICBzY29wZWQ/OiBib29sZWFuO1xuICAgIGNsb3NlPzogKGFsZXJ0czogSmhpQWxlcnRbXSkgPT4gdm9pZDtcbn1cblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBKaGlBbGVydFNlcnZpY2Uge1xuXG4gICAgcHJpdmF0ZSBhbGVydElkOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBhbGVydHM6IEpoaUFsZXJ0W107XG4gICAgcHJpdmF0ZSB0aW1lb3V0OiBudW1iZXI7XG4gICAgcHJpdmF0ZSB0b2FzdDogYm9vbGVhbjtcbiAgICBwcml2YXRlIGkxOG5FbmFibGVkOiBib29sZWFuO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgc2FuaXRpemVyOiBTYW5pdGl6ZXIsXG4gICAgICAgIHByaXZhdGUgY29uZmlnU2VydmljZTogSmhpQ29uZmlnU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGVTZXJ2aWNlXG4gICAgKSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuY29uZmlnU2VydmljZS5nZXRDb25maWcoKTtcbiAgICAgICAgdGhpcy50b2FzdCA9IGNvbmZpZy5hbGVydEFzVG9hc3Q7XG4gICAgICAgIHRoaXMuaTE4bkVuYWJsZWQgPSBjb25maWcuaTE4bkVuYWJsZWQ7XG4gICAgICAgIHRoaXMuYWxlcnRJZCA9IDA7IC8vIHVuaXF1ZSBpZCBmb3IgZWFjaCBhbGVydC4gU3RhcnRzIGZyb20gMC5cbiAgICAgICAgdGhpcy5hbGVydHMgPSBbXTtcbiAgICAgICAgdGhpcy50aW1lb3V0ID0gY29uZmlnLmFsZXJ0VGltZW91dDtcbiAgICB9XG5cbiAgICBjbGVhcigpIHtcbiAgICAgICB0aGlzLmFsZXJ0cy5zcGxpY2UoMCwgdGhpcy5hbGVydHMubGVuZ3RoKTtcbiAgICB9XG5cbiAgICBnZXQoKTogSmhpQWxlcnRbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFsZXJ0cztcbiAgICB9XG5cbiAgICBzdWNjZXNzKG1zZzogc3RyaW5nLCBwYXJhbXM/OiBhbnksIHBvc2l0aW9uPzogc3RyaW5nKTogSmhpQWxlcnQge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGRBbGVydCh7XG4gICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXG4gICAgICAgICAgICBtc2csXG4gICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICB0aW1lb3V0OiB0aGlzLnRpbWVvdXQsXG4gICAgICAgICAgICB0b2FzdDogdGhpcy5pc1RvYXN0KCksXG4gICAgICAgICAgICBwb3NpdGlvblxuICAgICAgICB9LCBbXSk7XG4gICAgfVxuXG4gICAgZXJyb3IobXNnOiBzdHJpbmcsIHBhcmFtcz86IGFueSwgcG9zaXRpb24/OiBzdHJpbmcpOiBKaGlBbGVydCB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZEFsZXJ0KHtcbiAgICAgICAgICAgIHR5cGU6ICdkYW5nZXInLFxuICAgICAgICAgICAgbXNnLFxuICAgICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgICAgdGltZW91dDogdGhpcy50aW1lb3V0LFxuICAgICAgICAgICAgdG9hc3Q6IHRoaXMuaXNUb2FzdCgpLFxuICAgICAgICAgICAgcG9zaXRpb25cbiAgICAgICAgfSwgW10pO1xuICAgIH1cblxuICAgIHdhcm5pbmcobXNnOiBzdHJpbmcsIHBhcmFtcz86IGFueSwgcG9zaXRpb24/OiBzdHJpbmcpOiBKaGlBbGVydCB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZEFsZXJ0KHtcbiAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgIG1zZyxcbiAgICAgICAgICAgIHBhcmFtcyxcbiAgICAgICAgICAgIHRpbWVvdXQ6IHRoaXMudGltZW91dCxcbiAgICAgICAgICAgIHRvYXN0OiB0aGlzLmlzVG9hc3QoKSxcbiAgICAgICAgICAgIHBvc2l0aW9uXG4gICAgICAgIH0sIFtdKTtcbiAgICB9XG5cbiAgICBpbmZvKG1zZzogc3RyaW5nLCBwYXJhbXM/OiBhbnksIHBvc2l0aW9uPzogc3RyaW5nKTogSmhpQWxlcnQge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGRBbGVydCh7XG4gICAgICAgICAgICB0eXBlOiAnaW5mbycsXG4gICAgICAgICAgICBtc2csXG4gICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICB0aW1lb3V0OiB0aGlzLnRpbWVvdXQsXG4gICAgICAgICAgICB0b2FzdDogdGhpcy5pc1RvYXN0KCksXG4gICAgICAgICAgICBwb3NpdGlvblxuICAgICAgICB9LCBbXSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmYWN0b3J5KGFsZXJ0T3B0aW9uczogSmhpQWxlcnQpOiBKaGlBbGVydCB7XG4gICAgICAgIGNvbnN0IGFsZXJ0OiBKaGlBbGVydCA9IHtcbiAgICAgICAgICAgIHR5cGU6IGFsZXJ0T3B0aW9ucy50eXBlLFxuICAgICAgICAgICAgbXNnOiB0aGlzLnNhbml0aXplci5zYW5pdGl6ZShTZWN1cml0eUNvbnRleHQuSFRNTCwgYWxlcnRPcHRpb25zLm1zZyksXG4gICAgICAgICAgICBpZDogYWxlcnRPcHRpb25zLmlkLFxuICAgICAgICAgICAgdGltZW91dDogYWxlcnRPcHRpb25zLnRpbWVvdXQsXG4gICAgICAgICAgICB0b2FzdDogYWxlcnRPcHRpb25zLnRvYXN0LFxuICAgICAgICAgICAgcG9zaXRpb246IGFsZXJ0T3B0aW9ucy5wb3NpdGlvbiA/IGFsZXJ0T3B0aW9ucy5wb3NpdGlvbiA6ICd0b3AgcmlnaHQnLFxuICAgICAgICAgICAgc2NvcGVkOiBhbGVydE9wdGlvbnMuc2NvcGVkLFxuICAgICAgICAgICAgY2xvc2U6IChhbGVydHM6IEpoaUFsZXJ0W10pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9zZUFsZXJ0KGFsZXJ0T3B0aW9ucy5pZCwgYWxlcnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKCFhbGVydC5zY29wZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWxlcnRzLnB1c2goYWxlcnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhbGVydDtcbiAgICB9XG5cbiAgICBhZGRBbGVydChhbGVydE9wdGlvbnM6IEpoaUFsZXJ0LCBleHRBbGVydHM6IEpoaUFsZXJ0W10pOiBKaGlBbGVydCB7XG4gICAgICAgIGFsZXJ0T3B0aW9ucy5pZCA9IHRoaXMuYWxlcnRJZCsrO1xuICAgICAgICBpZiAodGhpcy5pMThuRW5hYmxlZCAmJiBhbGVydE9wdGlvbnMubXNnKSB7XG4gICAgICAgICAgICBhbGVydE9wdGlvbnMubXNnID0gdGhpcy50cmFuc2xhdGVTZXJ2aWNlLmluc3RhbnQoYWxlcnRPcHRpb25zLm1zZywgYWxlcnRPcHRpb25zLnBhcmFtcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWxlcnQgPSB0aGlzLmZhY3RvcnkoYWxlcnRPcHRpb25zKTtcbiAgICAgICAgaWYgKGFsZXJ0T3B0aW9ucy50aW1lb3V0ICYmIGFsZXJ0T3B0aW9ucy50aW1lb3V0ID4gMCkge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUFsZXJ0KGFsZXJ0T3B0aW9ucy5pZCwgZXh0QWxlcnRzKTtcbiAgICAgICAgICAgIH0sIGFsZXJ0T3B0aW9ucy50aW1lb3V0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWxlcnQ7XG4gICAgfVxuXG4gICAgY2xvc2VBbGVydChpZDogbnVtYmVyLCBleHRBbGVydHM/OiBKaGlBbGVydFtdKTogYW55IHtcbiAgICAgICAgY29uc3QgdGhpc0FsZXJ0czogSmhpQWxlcnRbXSA9IChleHRBbGVydHMgJiYgZXh0QWxlcnRzLmxlbmd0aCA+IDApID8gZXh0QWxlcnRzIDogdGhpcy5hbGVydHM7XG4gICAgICAgIHJldHVybiB0aGlzLmNsb3NlQWxlcnRCeUluZGV4KHRoaXNBbGVydHMubWFwKChlKSA9PiBlLmlkKS5pbmRleE9mKGlkKSwgdGhpc0FsZXJ0cyk7XG4gICAgfVxuXG4gICAgY2xvc2VBbGVydEJ5SW5kZXgoaW5kZXg6IG51bWJlciwgdGhpc0FsZXJ0czogSmhpQWxlcnRbXSk6IEpoaUFsZXJ0W10ge1xuICAgICAgICByZXR1cm4gdGhpc0FsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cblxuICAgIGlzVG9hc3QoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRvYXN0O1xuICAgIH1cbn1cbiJdfQ==